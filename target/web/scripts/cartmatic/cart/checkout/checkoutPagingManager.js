function fnSelectWrap(){var a=$("input[name='wrap_wrapId'][checked]").val();if(a){var b=$("#wrapPrice_"+a).val();var c=parseFloat(b).toFixed(2);$("#cart_wrap").text(c);if(b==0){$("#wrap_tr").hide();$("#wrap").val("false")}else{$("#wrap_tr").show();$("#wrap").val("true")}fnUpdatePrice();if(a>0){$("#cardForm").show()}else{$("#cardForm").hide()}}}function fnSelectShipping(){fnUpdatePrice()}function fnUpdatePrice(){var e=parseFloat($("#cart_total").text());var b=parseFloat($("#save").text());var a=parseFloat($("#giftPay").text());var f=parseFloat($("#point").text());var g=b+a+f;$("#discount").text(g.toFixed(2));var c=parseFloat(e-g);if(c<0){c=0}if(c<100){var d=parseFloat($("#cart_shipping").text());c=c+d;$("#shippingRate").text(d.toFixed(2))}$("#cart_sum").text(c.toFixed(2))}function fnCheckPlaceOrder(){if($("input[name='shippingMethodId'][checked]").length==0){alert(__FMT.checkou_noship);return false}return true}function showExplain(c){var a=c.value;var b=$("[name='pmd']");b.each(function(d){if(this.id==("pmd_"+a)){$(this).show()}else{$(this).hide()}})}function fnUseGift(e){var a=$("#giftPaymentData").data("giftList");if(!a){a=new Array()}if(!e){e=$("#giftCertificateNo").val();e=e.trim();for(var c=0;c<a.length;c++){if(a[c].code==e){alert("This Gift Certificate has already been used.");return}}}var b=parseFloat($("#cart_sum").text());var d=0;$.post(__ctxPath+"/checkout/paymentProcess.html?doAction=doUseGc",{giftCertificateNo:e,money:b},function(g){if(g.status==1){var j=e;var i=g.data;a.push({code:j,money:i});$("#giftPaymentData").data("giftList",a);$("#usedGiftNoTab").append("<span id="+j+">"+j+"&nbsp;&nbsp;&nbsp;&nbsp;Â¥"+i+'<a href="javascript:void(0)" onclick="fnRemoveGift(\''+j+'\')" title="'+__FMT.del+'">  [X]</a><br/></span>');$("#usedGiftNoDiv").show();var f=parseFloat($("#giftPay").text());$("#giftPay").text(f+i);$("#gift_tr").show();$("#cart_sum").text(b-i);var h=$("#giftCertificateNos").val();if(h!=""){h+="#"}h+=j+":"+i;$("#giftCertificateNos").val(h);$("#giftCertificate").val(true);$("#giftCertificateNo").val("");$("#giftContent").hide()}else{alert(g.msg)}},"json")}function fnRemoveGift(h){var d=parseFloat($("#cart_sum").text());var b=parseFloat($("#giftPay").text());var a=$("#giftPaymentData").data("giftList");var f=0;var g=0;for(var e=0;e<a.length;e++){if(a[e].code==h){g=a[e].money;a.splice(e,1);break}}var c="";for(var e=0;e<a.length;e++){if(e!=0){c+="#"}c+=a[e].code+":"+a[e].money}$("#giftCertificateNos").val(c);$("#giftPay").text(f);$("#cart_sum").text(d+g);$("#"+h).remove();if(a.length==0){$("#usedGiftNoDiv").hide();$("#giftCertificate").val(false)}else{$("#usedGiftNoDiv").show()}$("#giftContent").show()}$(document).ready(function(){$("input[name='wrap_wrapId']").change(fnSelectWrap);$("input[name='shippingMethodId']").change(fnSelectShipping);fnSelectWrap();fnSelectShipping();$("#giftCertificateNos").val("");$("#giftCertificate").val(false);$("#myGiftList").find("a").click(function(){var a=$(this).closest("tr").attr("giftNum");fnUseGift(a)})});