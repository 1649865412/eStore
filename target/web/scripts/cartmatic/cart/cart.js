var ShoppingcartManager=function(){};ShoppingcartManager.addToC=function(a,d,c,b){this.$add(a,d,c,1,b)};ShoppingcartManager.addToF=function(a,c,b){this.$add(a,c,b,0)};ShoppingcartManager.submitCart=function(){$("#cart_form").submit()};ShoppingcartManager.$add=function(skuCode,pSkuCodes,quantity,type,accessories){if(!accessories){accessories=""}if($cm.isBusy){return}else{$cm.isBusy=true;setTimeout("$cm.isBusy=false",1000)}var obj=getEventSourceObject();if(type==0){if(pSkuCodes==null||pSkuCodes.length==0){ajaxCall(__ctxPath+"/cart/shoppingcart.html","doAction=addProductToFavorite&productsku="+skuCode+"&quantity="+quantity+"&accessoryIds="+accessories,"POST",true,function(data){if(data=="ok"){ShoppingcartManager.alert(skuCode,0,obj)}else{alert(__FMT.notAnonymousF)}})}else{ajaxCall(__ctxPath+"/cart/shoppingcart.html","doAction=addMultiProductToCart&productsku="+skuCode+"&quantity="+quantity+"&accessoryIds="+accessories+"&childrenskus="+pSkuCodes+"&isSaved=true","POST",true,function(data){if(data=="ok"){ShoppingcartManager.alert(skuCode,0,obj)}else{alert(__FMT.notAnonymousF)}})}}else{if(type==1){$(obj).removeClass("addtocart-on").addClass("loading");if(pSkuCodes==null||pSkuCodes.length==0){var customMade=$("#customMadeForm:visible").find("input[name^='customMade_']").serialize();ajaxCall(__ctxPath+"/cart/shoppingcart.html","doAction=addProductToCart&productsku="+skuCode+"&quantity="+quantity+"&accessoryIds="+accessories+"&"+customMade,"POST",true,function(data){var jdata=eval("("+data+")");var adata=jdata.message.split(":");if(adata[0]==__FMT.cannotMoveToC){alert(adata[1]+__FMT.update_stockNotEnough)}else{if(adata[0]==__FMT.noMoreInvetory){alert(adata[1]+__FMT.update_noMoreInventory)}else{ShoppingcartManager.alert(skuCode,1,obj,jdata)}}$(obj).removeClass("loading").addClass("addtocart-on")})}else{ajaxCall(__ctxPath+"/cart/shoppingcart.html","doAction=addMultiProductToCart&productsku="+skuCode+"&quantity="+quantity+"&accessoryIds="+accessories+"&childrenskus="+pSkuCodes,"POST",true,function(data){data=data.split(":");if(data[0]==__FMT.cannotMoveToC){alert(data[1]+__FMT.update_stockNotEnough)}else{if(data[0]==__FMT.noMoreInvetory){alert(data[1]+__FMT.update_noMoreInventory)}else{ShoppingcartManager.alert(skuCode,1,obj)}}$(obj).removeClass("loading").addClass("addtocart-on")})}}}};ShoppingcartManager.updateCartItem=function(){$("#doAction").val("updateShoppingcartItem");ShoppingcartManager.submitCart()};ShoppingcartManager.moveToC=function(a){$("#selected_itemId").val(a);$("#doAction").val("moveFavoriteItemToCart");ShoppingcartManager.submitCart()};ShoppingcartManager.moveToF=function(a){$("#selected_itemId").val(a);$("#doAction").val("moveCartItemToFavorite");ShoppingcartManager.submitCart()};ShoppingcartManager.deleteItem=function(a){$("#selected_itemId").val(a);$("#doAction").val("deleteItem");ShoppingcartManager.submitCart()};ShoppingcartManager.clearC=function(){$("#doAction").val("clearShoppingcart");ShoppingcartManager.submitCart()};ShoppingcartManager.clearF=function(){$("#doAction").val("clearFavorite");ShoppingcartManager.submitCart()};ShoppingcartManager.useCoupon=function(){if($("#couponNo_input_id").val()==""){return false}else{var a=parseFloat($("#cart_dis_member").val());$.post(__ctxPath+"/cart/shoppingcart.html?doAction=useCoupon",{couponNo_input_name:$("#couponNo_input_id").val()},function(b){var g=0;if(b.status==1){var d=b.data;$("#cartDiscountAmount").text((d+a).toFixed(2));g=parseFloat($("#cartDiscountAmount").text());$("#giftCertificateNo").attr("disabled",true)}else{alert(b.msg);g=0;$("#cartDiscountAmount").text(a.toFixed(2));$("#giftCertificateNo").attr("disabled",false)}var c=parseFloat($("#cart_sum_prev").val());g=parseFloat($("#cartDiscountAmount").text());var h=parseFloat($("#giftPay").text());var f=parseFloat($("#shopPointMoney").text());var e=parseFloat(c-g-h-f).toFixed(2);$("#cart_sum").text(e<0?"0.00":e);if(e<300){$("#selectbasic").attr("disabled",true)}else{$("#selectbasic").attr("disabled",false)}},"json")}};ShoppingcartManager.notUseCoupon=function(){$("#doAction").val("notuseCoupon");ShoppingcartManager.submitCart()};ShoppingcartManager.alert=function(c,b,f,e){if(e.result==0){alert(e.message);return}var a=function(h,g){this.skucode=h;this.type=g;this.$obj=f};a.prototype={id:"shoppingcartAlertWId_",skucode:"",type:1,messageDlgZIndex:1000,$obj:"",html:format_params($("#shoppingCartTemplate").val(),e.lastAddToCartItemQty,e.lastAddToCartItemImage,e.lastAddToCartItemName,__defaultCurrencySymbol+e.lastAddToCartItemPrice,e.lastAddToCartItemQty,e.cartItemQty,__defaultCurrencySymbol+e.total),show:function(){if(this.type==1){}else{this.html=this.html.replace("?Icount?",getCookie(__FMT.f_itemcount_cookie));this.html=this.html.replace("?type?",__FMT.favorite_)}var g=fnCreateSimpleDialog(this.id,"","",{});$("#_dlgContBox"+this.id).html(this.html);g.showDialog();if($mnc){$mnc.refresh()}}};var d=new a(c,b);d.show()};ShoppingcartManager.minicart=function(){};ShoppingcartManager.minicart.prototype={div:"minicartDiv",refresh:function(){if($("#"+this.div)){var b=getCookie(__FMT.c_itemcount_cookie);b=b==null?"0":b;var a=getCookie(__FMT.minicart_totalprice_cookie);a=a==null?fnFormatPrice(0):fnFormatPrice(a);$("#"+this.div).html(format_params($("#minicartDivTemplate").html(),b,a))}}};var $mnc=new ShoppingcartManager.minicart();addOnload(function(){$cm.isBusy=false});$cm=ShoppingcartManager;function moveCartBtn(a){if(!($(a).hasClass("loading")||$(a).hasClass("stock")||$(a).hasClass("no-addtocart"))){if($(a).hasClass("addtocart-on")){$(a).removeClass("addtocart-on")}else{$(a).addClass("addtocart-on")}}}function addToFavorite(a){doRequiredLoginAction(function(){$.post(__ctxPath+"/ajaxFavorite.html?doAction=addFavorite&productId="+a,function(b){var d=0;d=b.data==0?"1":b.data;$("#love_count").html("<span>"+d+"</span>个人喜欢");var c=function(){};c.prototype={id:"favoriteAlertWId_"+a,messageDlgZIndex:1000,html:format_params($("#favoriteTemplate").html(),b.msg),show:function(){var f=fnCreateSimpleDialog(this.id,"","",{});$("#_dlgContBox"+this.id).html(this.html);f.showDialog()}};var e=new c();e.show()})})};