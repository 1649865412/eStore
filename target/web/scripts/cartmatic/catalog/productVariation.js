var optional_class=["","box-txt","box-color","box-img"];var block_class=["","block-txt","block-color","block-img"];var selected_class=["","selected-txt","selected-color","selected-img"];var undeterminedAttributes="";var productVariationAttributes=new Array();var productVariationAttributeNames=new Array();var productVariations=new Array();var productVariationOptions=new Array();var jsonProductSkus=new Array();var inited=false;function variationChangeAction(v,z,s){if(!s){if(!inited){return}}var y=$("#div_"+v+"_"+z).get(0);var g=$("#option_value_"+v).val();if(y.className==optional_class[getClassIndex(v,z)]){$("#div_"+v+"_"+z).attr("class",selected_class[getClassIndex(v,z)]);$("#option_value_"+v).get(0).value=z;if(g!=""){$("#div_"+v+"_"+g).get(0).className=optional_class[getClassIndex(v,g)]}}else{if(y.className==selected_class[getClassIndex(v,z)]){$("#div_"+v+"_"+z).get(0).className=optional_class[getClassIndex(v,z)];$("#option_value_"+v).val("")}else{return}}var l=document.getElementById("productVaritionAttributes");var b=l.getElementsByTagName("div");for(var u=0;u<b.length;u++){var m=b[u];var c=m.id;if(c.indexOf("div_")!=-1){var w=c.substring(c.indexOf("_")+1,c.lastIndexOf("_"));var f=c.substring(c.lastIndexOf("_")+1,c.length);if(w!=v&&m.className==optional_class[getClassIndex(w,f)]){m.className=block_class[getClassIndex(w,f)]}}}var e=new Array();undeterminedAttributes="";for(var u=0;u<productVariationAttributes.length;u++){var n=$("#option_value_"+productVariationAttributes[u]).val();e.push(n);if(n==""){undeterminedAttributes=undeterminedAttributes+productVariationAttributeNames[u]+","}}var h=new Array();for(var u=0;u<productVariations.length;u++){var t=true;for(var r=0;r<e.length;r++){t=(e[r]==""||e[r]==productVariations[u][r]);if(!t){break}}if(t){h.push(productVariations[u])}}for(var u=0;u<h.length;u++){for(var r=0;r<productVariationAttributes.length;r++){var o=productVariationAttributes[r];var x=h[u][r];if($("#div_"+o+"_"+x).get(0).className==block_class[getClassIndex(o,x)]){$("#div_"+o+"_"+x).get(0).className=optional_class[getClassIndex(o,x)]}}}var a=new Array();for(var r=0;r<e.length;r++){for(var u=0;u<productVariations.length;u++){if(e[r]==""){break}var t=true;for(var q=0;q<e.length;q++){t=(e[q]==""||e[q]==productVariations[u][q]||e[r]==e[q]);if(!t){break}}if(t){a.push(productVariations[u])}}}for(var u=0;u<a.length;u++){for(var r=0;r<productVariationAttributes.length;r++){var o=productVariationAttributes[r];var x=a[u][r];var n=$("#option_value_"+o).val();if(n!=""&&$("#div_"+o+"_"+x).get(0).className==block_class[getClassIndex(o,x)]){$("#div_"+o+"_"+x).get(0).className=optional_class[getClassIndex(o,x)]}}}if(undeterminedAttributes!=""){undeterminedAttributes=undeterminedAttributes.substring(0,undeterminedAttributes.length-1);$("#productSkuCode").val("");return}var p=null;for(var u=0;u<productVariations.length;u++){t=true;for(var r=0;r<e.length;r++){t=(e[r]==productVariations[u][r]);if(!t){break}}if(t){p=productVariations[u][e.length];break}}if(p){var d=null;for(var u=0;u<jsonProductSkus.length;u++){if(jsonProductSkus[u].productSkuId==p){d=jsonProductSkus[u];break}}if(d){fnChangeSku(d)}else{log("jsonProductSkus 不存在该sku")}}else{log("没有相应的productVariation,暂时不存在(必须所有属性已选)")}}function getClassIndex(a,b){var c=$("#option_value_type_"+a+"_"+b).val();if(c==null||c==""){c=0}return c}function fnChangeSku(e){$("#productSkuCode").val(e.productSkuCode);$("#productSkuCodeSpan").html(e.productSkuCode);$("#priceSpan").html(__defaultCurrencySymbol+e.price);if(e.priceViewType==2){var c=__defaultCurrencySymbol+e.salePrice;c+="("+e.discountPercent+"%)";$("#salePriceSpan").html(c);$("#salePrice_content").show()}else{$("#salePriceSpan").html("");$("#salePrice_content").hide()}if(e.priceViewType==3){var f=__defaultCurrencySymbol+e.discountPrice;f+="("+e.discountPercent+"%)";$("#discountPriceSpan").html(f);$("#discountPrice_content").show()}else{$("#discountPriceSpan").html("");$("#discountPrice_content").hide()}if(e.priceViewType==1){$("#listPriceSpan").html(__defaultCurrencySymbol+e.listPrice);$("#listPrice_content").show()}else{$("#listPriceSpan").html("");$("#listPrice_content").hide()}if(e.priceViewType==2||e.priceViewType==3){$("#priceSpan").attr("class","price")}else{$("#priceSpan").attr("class","ourPrice")}if(e.weight){$("#weightSpan").html(e.weight);$("#weight_content").show()}else{$("#weightSpan").html("");$("#weight_content").hide()}var d=e.wholesalePrices;var a='<table width="100%" border="0" cellspacing="0" cellpadding="0">';for(var b=0;b<d.length;b++){a+="<tr>";a+='<td width="100px;">';if(b==0){a+=__FMT.productDetail_wholesalePrices+"："}else{a+="&nbsp;"}a+="</td>";a+='<td class="wholesalePrice" >';a+=d[b].minQuantity;if(b==d.length-1){a+=" +"}else{a+=" - "+(d[b+1].minQuantity-1)}a+="</td>";a+='<td class="wholesalePrice" >';a+=":"+__defaultCurrencySymbol+d[b].price;a+="</td>";a+="</tr>"}a+="</table>";$("#wholesalePrice_content").html(a);if(d.length>0){$("#wholesalePrice_content").show()}else{$("#wholesalePrice_content").hide()}if(jsonProduct.availabilityRule!=4){fnChangeAddToCartBtn(e.inventory)}if(e.image){originalPicURLs[0]=__mediaPath+e.image;standarPicURLs[0]=__mediaPath+fnGetProductImage(e.image,1);smallPicURLs[0]=__mediaPath+fnGetProductImage(e.image,2);if($("#smallpic_0")){$("#smallpic_0").attr("src",smallPicURLs[0])}$("#IMG_DIV").attr("src",standarPicURLs[0])}}function fnGetProductImage(d,a){var c=d.substring(0,d.lastIndexOf("."));var b=d.substring(d.lastIndexOf("."),d.length);if(a==1){return c+"_md"+b}else{if(a==2){return c+"_mn"+b}}return d}function fnChangeAddToCartBtn(a){if(a.availableQuantity>0||jsonProduct.availabilityRule==4){$("#productStockSpan").html(a.availableQuantity);$("#addToCart").attr("src",__ctxPath+__FMT.image_btn_addtocart_on);$("#addToCart").attr("alt","Add To Cart");$("#addToCart").get(0).disabled=false}else{if(jsonProduct.availabilityRule==2&&(jsonProduct.preOrBackOrderLimit<1||a.preOrBackOrderedQty<jsonProduct.preOrBackOrderLimit)){var b=__FMT.productDetail_inventory_preOrder;$("#productStockSpan").html(b.replace("{0}",jsonProduct.expectedReleaseDate));$("#addToCart").attr("src",__ctxPath+__FMT.image_btn_addtocart_preOrder);$("#addToCart").attr("alt","Pre Order");$("#addToCart").get(0).disabled=false}else{if(jsonProduct.availabilityRule==3&&(jsonProduct.preOrBackOrderLimit<1||a.preOrBackOrderedQty<jsonProduct.preOrBackOrderLimit)){var b;if(a.expectedRestockDate){b=__FMT.productDetail_inventory_backOrder;b=b.replace("{0}",a.expectedRestockDate)}else{b=__FMT.productDetail_inventory_will_ship}$("#productStockSpan").html(b);$("#addToCart").attr("src",__ctxPath+__FMT.image_btn_addtocart_backOrder);$("#addToCart").attr("alt","Back Order");$("#addToCart").get(0).disabled=false}else{var b;if(a.expectedRestockDate){b=__FMT.productDetail_inventory_outof_stock_will_ship;b=b.replace("{0}",a.expectedRestockDate)}else{b=__FMT.productDetail_inventory_outof_stock}$("#productStockSpan").html(b);$("#addToCart").attr("src",__ctxPath+__FMT.image_btn_addtocart_off);$("#addToCart").attr("alt","暂无库存！");$("#addToCart").get(0).disabled=true}}}};