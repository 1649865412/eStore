function isLoginedAtServer(){var a;$.ajax({type:"GET",url:__ctxPath+"/ajaxCurrentUser.html",async:false,dataType:"json",success:function(b){a=b.data.appUserId}});return a=="-2"?false:true}var globalLoginCallback=null;function doRequiredLoginAction(b,a){if(!a){globalLoginCallback=b}if(!isLoginedAtServer()){if(window.confirm(__FMT.loginConfirm)){fnShowLoginDialog()}}else{globalLoginCallback=b;execLoginCallback()}}function execLoginCallback(){if(globalLoginCallback!=null){globalLoginCallback.call();globalLoginCallback=null}}var dlgLogin=null;function fnShowLoginDialog(){if(dlgLogin==null){dlgLogin=fnCreateSimpleDialog("Login",__FMT.first_login,null,{dialogWidth:"400px",dialogHeight:"180px"})}dlgLogin.showDialog(__ctxPath+"/loginDlg.html?decorator=blank",function(){$("#j_username").val(getLoginUserEmail(false))})}function fnDoLoginHandler(){var b=$("#j_username").val();var a=$("#j_password").val();if(trim(b)==""){alert(__FMT.customer_username_isRequired);$("#j_username").focus();return}if(trim(a)==""){alert(__FMT.customer_password_isRequired);$("#j_password").focus();return}$.post(__ctxPath+"/ajaxLogin.html",{username:b,password:a},function(c){if(c.status==1){dlgLogin.closeDialog();fillLoginPrompt();$mnc.refresh();execLoginCallback()}else{$("#loginMsg").html("<font color='red'>"+__FMT.customer_login_fail+"</font>")}},"json")}function password_onkeypress(b){var a=(b.keyCode==null)?b.charCode:b.keyCode;if(a==13){fnDoLoginHandler()}};